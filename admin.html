<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>StreamFlix - Admin Panel</title>
    <style>
        /* CSS Styles are the same as before */
        :root { --primary-color-dark: #141414; --secondary-color-dark: #1f1f1f; --font-color-dark: #f5f5f5; --accent-color-dark: #e50914; --border-radius: 8px; }
        body { background-color: var(--primary-color-dark); color: var(--font-color-dark); font-family: 'Helvetica Neue', Helvetica, Arial, sans-serif; padding: 2rem; }
        h1 { margin-bottom: 2rem; }
        .upload-movie-btn { padding: 0.8rem 1.5rem; background-color: #28a745; color: white; border: none; border-radius: var(--border-radius); cursor: pointer; font-size: 1rem; margin-bottom: 2rem; }
        .upload-movie-btn:hover { background-color: #218838; }
        #admin-movie-list { list-style: none; padding: 0; }
        .admin-movie-item { display: flex; justify-content: space-between; align-items: center; padding: 1rem; background-color: var(--secondary-color-dark); border-radius: var(--border-radius); margin-bottom: 1rem; }
        .admin-movie-controls button { margin-left: 0.5rem; padding: 0.5rem 1rem; border: none; border-radius: var(--border-radius); cursor: pointer; }
        .edit-btn { background-color: #ffc107; color: #000; }
        .delete-btn { background-color: #dc3545; color: #fff; }
        #upload-modal { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background-color: rgba(0, 0, 0, 0.8); display: none; justify-content: center; align-items: center; z-index: 3000; }
        #upload-modal.active { display: flex; }
        #upload-form-container { background-color: var(--secondary-color-dark); padding: 2rem; border-radius: var(--border-radius); width: 90%; max-width: 500px; }
        #upload-form h3 { margin-bottom: 1.5rem; }
        .form-group { margin-bottom: 1rem; }
        .form-group label { display: block; margin-bottom: 0.5rem; }
        .form-group input, .form-group select { width: 100%; padding: 0.8rem; border-radius: var(--border-radius); border: 1px solid #555; background-color: #333; color: var(--font-color-dark); }
        .form-actions { display: flex; justify-content: flex-end; gap: 1rem; margin-top: 1.5rem; }
        .form-actions button { padding: 0.8rem 1.5rem; border: none; border-radius: var(--border-radius); cursor: pointer; }
        #save-movie-btn { background-color: #28a745; color: #fff; }
        #cancel-upload-btn { background-color: #6c757d; color: #fff; }
    </style>
</head>
<body>
    
    <h1>Admin Movie Management</h1>
    <button class="upload-movie-btn" id="add-movie-btn">Upload New Movie</button>
    <ul id="admin-movie-list"></ul>

    <!-- ADMIN UPLOAD/EDIT FORM MODAL -->
    <div id="upload-modal">
        <div id="upload-form-container">
            <form id="upload-form">
                <h3 id="form-title">Add New Movie</h3>
                <input type="hidden" id="movie-id-input">
                <div class="form-group">
                    <label for="movie-title">Movie Title</label>
                    <input type="text" id="movie-title" required>
                </div>
                <div class="form-group">
                    <label for="poster-url">Poster Image URL</label>
                    <input type="url" id="poster-url" required>
                </div>
                <div class="form-group">
                    <label for="video-url">Video URL</label>
                    <input type="url" id="video-url" required>
                </div>
                <div class="form-group">
                    <label for="category-select">Category</label>
                    <select id="category-select" required>
                        <option value="Movie">Movie</option>
                        <option value="Anime">Anime</option>
                        <option value="Cartoon">Cartoon</option>
                        <option value="Series">Series</option>
                        <option value="Short Video">Short Video</option>
                    </select>
                </div>
                <div class="form-actions">
                    <button type="button" id="cancel-upload-btn">Cancel</button>
                    <button type="submit" id="save-movie-btn">Save Movie</button>
                </div>
            </form>
        </div>
    </div>

    <!-- Firebase SDK Scripts -->
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-database.js"></script>

    <script>
    document.addEventListener('DOMContentLoaded', () => {
        // --- FIREBASE INITIALIZATION ---
        const firebaseConfig = {
  apiKey: "AIzaSyAjtvzKqPQ4-Eb9kNAzmJP1igxWjGoDE2I",
  authDomain: "movie-stream-5df8d.firebaseapp.com",
  projectId: "movie-stream-5df8d",
  storageBucket: "movie-stream-5df8d.firebasestorage.app",
  messagingSenderId: "142368195075",
  appId: "1:142368195075:web:33e00e74be79b7d1084436"
};
        firebase.initializeApp(firebaseConfig);
        const database = firebase.database();
        // --- END OF FIREBASE INITIALIZATION ---

        let allMovies = [];

        const adminMovieList = document.getElementById('admin-movie-list');
        const uploadModal = document.getElementById('upload-modal');
        const addMovieBtn = document.getElementById('add-movie-btn');
        const cancelUploadBtn = document.getElementById('cancel-upload-btn');
        const uploadForm = document.getElementById('upload-form');
        const formTitle = document.getElementById('form-title');
        const movieIdInput = document.getElementById('movie-id-input');

        const renderAdminList = (moviesToRender) => {
            adminMovieList.innerHTML = '';
            moviesToRender.forEach(movie => {
                const listItem = document.createElement('li');
                listItem.className = 'admin-movie-item';
                listItem.innerHTML = `
                    <span>${movie.title} (${movie.category})</span>
                    <div class="admin-movie-controls">
                        <button class="edit-btn" data-id="${movie.id}">Edit</button>
                        <button class="delete-btn" data-id="${movie.id}">Delete</button>
                    </div>
                `;
                adminMovieList.appendChild(listItem);
            });
        };

        const listenForMovieChanges = () => {
            const moviesRef = database.ref('movies');
            moviesRef.on('value', (snapshot) => {
                const moviesData = snapshot.val();
                allMovies = moviesData ? Object.keys(moviesData).map(key => ({ id: key, ...moviesData[key] })) : [];
                renderAdminList(allMovies);
            }, (error) => {
                console.error("Firebase Read Error: ", error);
                alert("Could not fetch movies from the database.");
            });
        };

        const saveMovie = (movieData, movieId) => {
            if (movieId) {
                database.ref('movies/' + movieId).update(movieData)
                    .then(() => alert("Movie updated successfully!"))
                    .catch(e => { console.error("Update failed: ", e); alert("Update failed."); });
            } else {
                database.ref('movies').push(movieData)
                    .then(() => alert("Movie added successfully!"))
                    .catch(e => { console.error("Add failed: ", e); alert("Add failed."); });
            }
        };

        const deleteMovie = (movieId) => {
            database.ref('movies/' + movieId).remove()
                .then(() => alert("Movie deleted successfully!"))
                .catch(e => { console.error("Delete failed: ", e); alert("Delete failed."); });
        };

        const showUploadModal = (movie = null) => {
            uploadForm.reset();
            if (movie) {
                formTitle.textContent = 'Edit Movie';
                movieIdInput.value = movie.id;
                document.getElementById('movie-title').value = movie.title;
                document.getElementById('poster-url').value = movie.posterUrl;
                document.getElementById('video-url').value = movie.videoUrl;
                document.getElementById('category-select').value = movie.category;
            } else {
                formTitle.textContent = 'Add New Movie';
                movieIdInput.value = '';
            }
            uploadModal.classList.add('active');
        };

        const hideUploadModal = () => uploadModal.classList.remove('active');

        addMovieBtn.addEventListener('click', () => showUploadModal());
        cancelUploadBtn.addEventListener('click', hideUploadModal);
        
        uploadForm.addEventListener('submit', (e) => {
            e.preventDefault();
            const movieData = {
                title: document.getElementById('movie-title').value,
                posterUrl: document.getElementById('poster-url').value,
                videoUrl: document.getElementById('video-url').value,
                category: document.getElementById('category-select').value
            };
            const movieId = movieIdInput.value;
            saveMovie(movieData, movieId);
            hideUploadModal();
        });

        adminMovieList.addEventListener('click', (e) => {
            const editBtn = e.target.closest('.edit-btn');
            const deleteBtn = e.target.closest('.delete-btn');
            if (editBtn) {
                const movieToEdit = allMovies.find(m => m.id === editBtn.dataset.id);
                if (movieToEdit) showUploadModal(movieToEdit);
            }
            if (deleteBtn) {
                if (confirm('Are you sure you want to delete this movie? This cannot be undone.')) {
                    deleteMovie(deleteBtn.dataset.id);
                }
            }
        });
        
        listenForMovieChanges();
    });
    </script>
</body>
</html>